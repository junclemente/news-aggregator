APP.Main=function(){function q(a,b){for(var c=document.querySelectorAll(".story"),d=0;d<c.length;d++)if(c[d].getAttribute("id")==="s-"+a){b.time*=1e3;var e=c[d],f=n(b);e.innerHTML=f,e.addEventListener("click",r.bind(this,b)),e.classList.add("clickable"),h--}0===h&&u()}function r(a){var c=b("sd-"+a.id);if(setTimeout(s.bind(this,a.id),60),!c){a.url&&(a.urlobj=new URL(a.url));var d,e,f,g,h=o(a),j=a.kids,k=p({by:"",text:"Loading comment..."});c=document.createElement("section"),c.setAttribute("id","sd-"+a.id),c.classList.add("story-details"),c.innerHTML=h,document.body.appendChild(c),e=c.querySelector(".js-comments"),f=c.querySelector(".js-header"),g=c.querySelector(".js-content");var l=c.querySelector(".js-close");l.addEventListener("click",t.bind(this,a.id));var m=f.getBoundingClientRect().height;if(g.style.paddingTop=m+"px","undefined"==typeof j)return;for(var n=0;n<j.length;n++)d=document.createElement("aside"),d.setAttribute("id","sdc-"+j[n]),d.classList.add("story-details__comment"),d.innerHTML=k,e.appendChild(d),APP.Data.getStoryComment(j[n],function(a){a.time*=1e3;var b=e.querySelector("#sdc-"+a.id);b.innerHTML=p(a,i)})}}function s(a){function e(){var a=c.getBoundingClientRect();null===d&&(d=a.left),d+=.1*(0-a.left),Math.abs(d)>.5?setTimeout(e,4):d=0,c.style.left=d+"px"}if(!g){g=!0;var c=b("#sd-"+a),d=null;c&&(document.body.classList.add("details-active"),c.style.opacity=1,setTimeout(e,4))}}function t(a){function e(){var a=f.getBoundingClientRect(),b=c.getBoundingClientRect(),h=a.width+100;d+=.1*(h-b.left),Math.abs(d-h)>.5?setTimeout(e,4):(d=h,g=!1),c.style.left=d+"px"}if(g){var c=b("#sd-"+a),d=0;document.body.classList.remove("details-active"),c.style.opacity=0,setTimeout(e,4)}}function u(){for(var a=document.querySelectorAll(".story"),b=0;b<a.length;b++){var c=a[b],d=c.querySelector(".story__score"),e=c.querySelector(".story__title"),g=f.offsetHeight,i=(f.getBoundingClientRect(),d.getBoundingClientRect().top-document.body.getBoundingClientRect().top),j=Math.min(1,1-.05*((i-170)/g)),k=Math.min(1,1-.5*((i-170)/g));d.style.width=40*j+"px",d.style.height=40*j+"px",d.style.lineHeight=40*j+"px",i=d.getBoundingClientRect();var l=100*((i.width-38)/2);d.style.backgroundColor="hsl(42, "+l+"%, 50%)",e.style.opacity=k}}function v(){if(!(h>0)){h=e;for(var a=d+e,b=d;b<a;b++){if(b>=c.length)return;var g=String(c[b]),i=document.createElement("div");i.setAttribute("id","s-"+g),i.classList.add("story"),i.innerHTML=n({title:"...",score:"-",by:"...",time:0}),f.appendChild(i),APP.Data.getStoryById(c[b],q.bind(this,g))}d+=e}}var a=300,b=document.querySelector.bind(document),c=null,d=0,e=100,f=b("main"),g=!1,h=0,i={data:{intl:{locales:"en-US"}}},j=b("#tmpl-story").textContent,k=b("#tmpl-story-details").textContent,l=b("#tmpl-story-details-comment").textContent;if("undefined"!=typeof HandlebarsIntl)HandlebarsIntl.registerWith(Handlebars);else{var m=/, {{ formatRelative time }}/;j=j.replace(m,""),k=k.replace(m,""),l=l.replace(m,"")}var n=Handlebars.compile(j),o=Handlebars.compile(k),p=Handlebars.compile(l);f.addEventListener("touchstart",function(a){Math.random()>.97&&a.preventDefault()}),f.addEventListener("scroll",function(){var c=b("header"),d=c.querySelector(".header__title-wrapper"),e=Math.min(70,f.scrollTop),g="scale("+(1-e/300)+")";u(),c.style.height=156-e+"px",d.style.webkitTransform=g,d.style.transform=g,f.scrollTop>70?document.body.classList.add("raised"):document.body.classList.remove("raised");var h=f.scrollHeight-f.offsetHeight-a;f.scrollTop>h&&v()}),APP.Data.getTopStories(function(a){c=a,v(),f.classList.remove("loading")})}();